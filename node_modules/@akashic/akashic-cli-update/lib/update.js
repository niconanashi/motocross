"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var cmn = require("@akashic/akashic-cli-commons");
function _completeUpdateParameterObject(param) {
    param.cwd = param.cwd || process.cwd();
    param.logger = param.logger || new cmn.ConsoleLogger();
    param.debugNpm = param.debugNpm || new cmn.PromisedNpm({ logger: param.logger });
}
exports._completeUpdateParameterObject = _completeUpdateParameterObject;
function promiseUpdate(param) {
    _completeUpdateParameterObject(param);
    var restoreDirectory = cmn.Util.chdir(param.cwd);
    return Promise.resolve()
        .then(function () { return param.debugNpm.update(param.moduleNames); })
        .then(function () { return param.logger.info("Done!"); })
        .then(restoreDirectory)
        .catch(function (err) {
        restoreDirectory();
        throw new Error(err);
    });
}
exports.promiseUpdate = promiseUpdate;
function update(param, cb) {
    promiseUpdate(param).then(cb, cb);
}
exports.update = update;
