"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs");
/**
 * game.json をファイルとして取り扱うモジュール。
 */
var ConfigurationFile;
(function (ConfigurationFile) {
    /**
     * game.json ファイルを読み込む。
     * なければ作成する。
     *
     * @param confPath game.jsonがある、または作成するディレクトリ。絶対パスであることを期待する。
     * @param logger ログ出力に用いるロガー。
     */
    function read(confPath, logger) {
        return new Promise(function (resolve, reject) {
            fs.readFile(confPath, "utf8", function (err, data) {
                if (err) {
                    if (err.code !== "ENOENT")
                        return void reject(err);
                    logger.info("No game.json found. Create a new one.");
                    data = "{}";
                }
                try {
                    resolve(JSON.parse(data));
                }
                catch (e) {
                    reject(e);
                }
            });
        });
    }
    ConfigurationFile.read = read;
    /**
     * game.json をファイルに書き込む。
     *
     * @param confPath game.jsonを保存するディレクトリ。絶対パスであることを期待する。
     * @param logger ログ出力に用いるロガー。
     */
    function write(content, confPath, logger) {
        return new Promise(function (resolve, reject) {
            var text = JSON.stringify(content, null, "\t");
            fs.writeFile(confPath, text, { encoding: "utf8" }, function (err) {
                if (err) {
                    reject(err);
                }
                else {
                    resolve();
                }
            });
        });
    }
    ConfigurationFile.write = write;
})(ConfigurationFile = exports.ConfigurationFile || (exports.ConfigurationFile = {}));
