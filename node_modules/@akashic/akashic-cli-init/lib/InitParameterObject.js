"use strict";
var commons = require("@akashic/akashic-cli-commons");
var config = require("@akashic/akashic-cli-config");
var os = require("os");
var path = require("path");
var templateConfigValidator = {
    "init.repository": "",
    "init.localTemplateDirectory": "",
    "init.defaultTemplateType": ""
};
/**
 * 未代入のパラメータを補完する
 */
function completeInitParameterObject(param) {
    param.logger = param.logger || new commons.ConsoleLogger();
    param.configFile = param.configFile || new config.AkashicConfigFile(templateConfigValidator);
    param.cwd = param.cwd || process.cwd();
    param.templateListJsonPath = param.templateListJsonPath || "template-list.json";
    return Promise.resolve()
        .then(function () { return param.configFile.load(); })
        .then(function () { return param.configFile.getItem("init.repository"); })
        .then(function (repository) {
        param.repository = param.repository || repository || "";
        return param.configFile.getItem("init.localTemplateDirectory");
    })
        .then(function (directory) {
        param.localTemplateDirectory =
            param.localTemplateDirectory ||
                directory ||
                path.join(os.homedir(), ".akashic-templates");
        return param.configFile.getItem("init.defaultTemplateType");
    })
        .then(function (defaultType) {
        param.type = (param.type || defaultType || "javascript").toLowerCase();
        // 以下の正規表現は、akashic-configのvalidatorとそろえる必要があります。
        if (!/^[\w\-]+$/.test(param.type))
            return Promise.reject(new Error("invalid template type name"));
        return Promise.resolve();
    });
}
exports.completeInitParameterObject = completeInitParameterObject;
//# sourceMappingURL=InitParameterObject.js.map